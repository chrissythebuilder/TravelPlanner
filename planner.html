<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title> Travel Planner </title>

    <link href="assets/css/reset.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Faster+One|PT+Sans:400,700" rel="stylesheet">

    <!-- Bootstrap Library -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
        crossorigin="anonymous">
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- Firebase Library -->
    <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>
    <!-- jQuery Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="assets/javascript/app.js"></script>
    
</head>

<body class="jumbotron">

    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Set up Planner Page -->

    <div id = "title">
        <h2>Planner Page</h2>
        <p>We would like to officially welcome you to BCKN Trip Planner Builder's page. In here, you will have the opportunity to start building your customized list of points of destinations for the selected date. <span id="strong"> Remember: Make use of our added weather feature to assist you in choosing which activities you'd like to participate in today. </span> </p>
    </div>
    <div id="weather-display">

    </div>
    <div class="form-group" id="general-search">
        <input type="text" class="form-control" id="general-input" placeholder="General search...">
        <br>
        <button class="btn btn-secondary" id="gen-item">Search</button>
    </div>
    <div class="form-group" id="advanced-search">
        <input type="text" class="form-control" id="advanced-input" placeholder="Advanced search...">
        <br>
        <button class="btn btn-secondary" id="adv-item">Search</button>
    </div>
    <div id="adv-disclaim">
        <button class="btn btn-link" id="open-advanced">Click here if you already know the name of the place you are looking for!</button>
    </div>
    <div id="gen-disclaim">
        <button class="btn btn-link" id="open-general">Click here for a general search.</button>
    </div>

    <div id="result-display"></div>

    <div class="row" id="images-display"></div>

    <div id="reviews-display"></div>

    <div id="list-display"></div>
    <br>
    <div class="form-group">
        <button class="btn btn-danger">Confirm List</button>
    </div>

    <script>
        //Initialize Firebase
        var config = {
            apiKey: "AIzaSyD3GtRS1N5UxrzvxA1i8XV0babAG61zf9Q",
            authDomain: "groupproject1-e81bf.firebaseapp.com",
            databaseURL: "https://groupproject1-e81bf.firebaseio.com",
            projectId: "groupproject1-e81bf",
            storageBucket: "groupproject1-e81bf.appspot.com",
            messagingSenderId: "825404731161"
        };
        firebase.initializeApp(config);

        var dataRef = firebase.database();

        // Define global variables
        var genItem = $("#gen-item");
        var advItem = $("#adv-item");
        var inputGeneral;
        var inputAdvanced;
        var search;
        var queryURL;
        var searchAdvanced = $("#advanced-search");
        var searchGeneral = $("#general-search");

        // To hide the opening fields.
        searchAdvanced.hide();
        $("#gen-disclaim").hide();

        function showSuggestions() {

        }

        // To run the General search, when the genItem button is clicked.
        function runGeneral() {
            // Add onclick even for the submit "add-item" button.
            genItem.on("click", function (event) {
                event.preventDefault();

                inputGeneral = $("#general-input").val().trim();
                inputAdvanced = $("#advanced-input").val("");
                $("#images-display").empty();
                $("#result-display").empty();

                // Main test: 1. Did the user input anything in to either text boxes? 2. Is the value < 5 characters?  
                if (inputGeneral !== "") {
                    if ($("#general-input").val().length < 5) {
                        alert("You must type at least 5 characters.");
                        // change alert to modal.
                    } else {
                        search = inputGeneral;
                        $("#general-input").val("");

                        var APIkey = "AIzaSyBMHhF1IhDFYqU-cjBf9YhaoTpDCB27lzI";
                        var cx = "000852579600713817389:mvwf8b9vrdi";

                        // Google Search API is limited to 100 Queries per day.***** This is an issue.
                        queryURL = "https://www.googleapis.com/customsearch/v1?key=" + APIkey + "&cx=" + cx + "&searchType=image&num=10&q=" + search;
                        // queryURL = "https://api.giphy.com/v1/gifs/search?q=" + search + "&api_key=lZmoHvNGfZTWDHmraYUAgeyzv20gygnH&limit=10";

                        $.ajax({
                            url: queryURL,
                            method: "GET"
                        }).then(function (response) {
                            var result = response.items;
                            console.log(result);
                            //Dynamically create divs and btn links for search results.
                            for (var j = 0; j < 5; j++) {
                                var resultDiv = $("<div>")
                                var resultDisplay = $("<button>" + result[j].snippet + "</button>");
                                resultDisplay.addClass("btn btn-link");
                                resultDiv.prepend(resultDisplay);
                                $("#result-display").append(resultDiv);
                            }
                        });
                    }
                } else {
                    alert("You did not type in the text field! Please try again.");
                    // insert modal here ********
                }
            });
        };

        // To run the Advanced search, when advItem button is clicked. 
        function runAdvanced() {
            // Add onclick even for the submit "add-item" button.
            advItem.on("click", function (event) {
                event.preventDefault();

                inputGeneral = $("#general-input").val("");
                inputAdvanced = $("#advanced-input").val().trim();
                $("#images-display").empty();
                $("#result-display").empty();

                // Main test: 1. Did the user input anything in to either text boxes? 2. Is the value < 5 characters?  
                if (inputAdvanced !== "") {
                    if ($("#advanced-input").val().length < 5) {
                        alert("You must type at least 5 characters.");
                        // change alert to modal.
                    } else {
                        search = inputAdvanced;
                        $("#advanced-input").val("");

                        var APIkey = "AIzaSyBMHhF1IhDFYqU-cjBf9YhaoTpDCB27lzI";
                        var cx = "000852579600713817389:mvwf8b9vrdi";

                        // Google Search API is limited to 100 Queries per day.***** This is an issue.
                        queryURL = "https://www.googleapis.com/customsearch/v1?key=" + APIkey + "&cx=" + cx + "&searchType=image&num=10&q=" + search;
                        // queryURL = "https://api.giphy.com/v1/gifs/search?q=" + search + "&api_key=lZmoHvNGfZTWDHmraYUAgeyzv20gygnH&limit=10";

                        $.ajax({
                            url: queryURL,
                            method: "GET"
                        }).then(function (response) {
                            var result = response.items;
                            console.log(result);

                            // Dynamically create divs and img tags for the images queried.
                            for (var i = 0; i < result.length; i++) {
                                var imageDiv = $("<div style='display:block; float:left' class='col col-3'>");
                                var image = $("<img style='height: auto; width:100%; max-width: 360px'>");
                                image.attr({
                                    "src": result[i].link,
                                })
                                console.log(result[i].link);
                                imageDiv.prepend(image);
                                $("#images-display").prepend(imageDiv);
                            }
                        });
                    }
                } else {
                    alert("You did not type in the text field! Please try again.");
                    // insert modal here ********
                }
            });
        };

        $("#open-advanced").on("click", function () {
            searchAdvanced.show();
            searchGeneral.hide();
            $("#images-display").empty();
            $("#result-display").empty();
            $("#gen-disclaim").show();
            $("#adv-disclaim").hide();
        });

        $("#open-general").on("click", function () {
            searchAdvanced.hide();
            searchGeneral.show();
            $("#images-display").empty();
            $("#result-display").empty();
            $("#gen-disclaim").hide();
            $("#adv-disclaim").show();
        });

        runGeneral();
        runAdvanced();
    </script>
</body>

</html>